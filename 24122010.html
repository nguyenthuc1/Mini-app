<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Qu·∫£n tr·ªã - Fish Mining</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .hack-warning { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
    </style>
</head>
<body class="p-4">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 bg-slate-800 p-6 rounded-2xl shadow-2xl">
            <div>
                <h1 class="text-2xl font-bold text-yellow-500">QU·∫¢N TR·ªä VI√äN üõ°Ô∏è</h1>
                <p class="text-xs text-gray-400">ƒê·ªëi so√°t th·ªùi gian & Ch·ªëng Cheat [cite: 2026-01-24]</p>
            </div>
            <button onclick="location.reload()" class="bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold">L√†m m·ªõi d·ªØ li·ªáu</button>
        </header>

        <div id="admin-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="col-span-full text-center py-20 text-gray-500">ƒêang ki·ªÉm tra d·ªØ li·ªáu t·ª´ Firebase...</div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAc0psT5Up6aEu0VnCz1TZ4sSNTKmif8oA",
            authDomain: "telegram-bot-backup-11c83.firebaseapp.com",
            databaseURL: "https://telegram-bot-backup-11c83-default-rtdb.firebaseio.com",
            projectId: "telegram-bot-backup-11c83",
            storageBucket: "telegram-bot-backup-11c83.firebasestorage.app",
            messagingSenderId: "363675104532",
            appId: "1:363675104532:web:6c51d1c7318b765e897e01"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('users').on('value', (snapshot) => {
            const users = snapshot.val();
            const container = document.getElementById('admin-content');
            let html = '';

            for (let uid in users) {
                const user = users[uid];
                if (user.history) {
                    user.history.forEach((item, index) => {
                        if (item.status === 'üïê ƒêang x·ª≠ l√Ω') {
                            // 1. T√çNH TO√ÅN ƒê·ªêI SO√ÅT CH·ªêNG HACK
                            let sailingTime = "Kh√¥ng r√µ";
                            let isSuspicious = false;
                            
                            if (user.startTime) {
                                const start = new Date(user.startTime);
                                const now = new Date();
                                const diffInMinutes = Math.floor((now - start) / 60000);
                                sailingTime = diffInMinutes + " ph√∫t";

                                // N·∫øu th·ªùi gian ra kh∆°i qu√° ng·∫Øn nh∆∞ng s·ªë ti·ªÅn qu√° l·ªõn -> Nghi v·∫•n hack
                                // Gi·∫£ s·ª≠ speed t·ªëi ƒëa 10/s, 1 ph√∫t max ƒë∆∞·ª£c 600 xu.
                                const maxExpected = diffInMinutes * (user.speed * 60) * 1.5; 
                                if (user.coins > maxExpected && diffInMinutes > 0) isSuspicious = true;
                            }

                            html += `
                            <div class="glass p-6 rounded-2xl ${isSuspicious ? 'hack-warning' : ''}">
                                <div class="flex justify-between items-start mb-4">
                                    <span class="text-[10px] font-mono text-blue-400">ID: ${uid}</span>
                                    ${isSuspicious ? '<span class="bg-red-600 text-[10px] px-2 py-1 rounded animate-pulse">NGHI V·∫§N HACK</span>' : ''}
                                </div>
                                
                                <div class="mb-4">
                                    <p class="text-xs text-gray-400 uppercase">S·ªë ti·ªÅn r√∫t</p>
                                    <h2 class="text-2xl font-bold text-yellow-400">${Number(item.amount).toLocaleString()} VNƒê</h2>
                                </div>

                                <div class="grid grid-cols-2 gap-4 text-xs mb-6 bg-slate-900/50 p-3 rounded-lg">
                                    <p>üè¶ Ng√¢n h√†ng: <b class="block text-white">${item.bankName || 'N/A'}</b></p>
                                    <p>üí≥ S·ªë t√†i kho·∫£n: <b class="block text-white">${item.bankAcc || 'N/A'}</b></p>
                                    <p>üë§ Ch·ªß TK: <b class="block text-white">${item.bankOwner || 'N/A'}</b></p>
                                    <p>‚è±Ô∏è ƒê√£ ra kh∆°i: <b class="block text-green-400">${sailingTime}</b></p>
                                </div>

                                <div class="flex gap-2">
                                    <button onclick="approve('${uid}', ${index})" class="flex-1 bg-green-600 py-2 rounded-lg font-bold text-sm">DUY·ªÜT ‚úÖ</button>
                                    <button onclick="reject('${uid}', ${index}, ${item.amount})" class="flex-1 bg-red-600 py-2 rounded-lg font-bold text-sm">H·ª¶Y (HACK) ‚ùå</button>
                                </div>
                            </div>`;
                        }
                    });
                }
            }
            container.innerHTML = html || '<div class="col-span-full text-center py-10 text-gray-500">Ch∆∞a c√≥ l·ªánh r√∫t ti·ªÅn n√†o c·∫ßn x·ª≠ l√Ω.</div>';
        });

        function approve(uid, idx) {
            if(confirm('X√°c nh·∫≠n l·ªánh r√∫t n√†y h·ª£p l·ªá?')) {
                db.ref(\`users/\${uid}/history/\${idx}\`).update({ status: '‚úÖ Th√†nh c√¥ng' });
            }
        }

        function reject(uid, idx, amount) {
            const reason = prompt("L√Ω do h·ªßy (S·ªë xu kh√¥ng kh·ªõp th·ªùi gian ra kh∆°i, cheat m·ªùi b·∫°n b√®...):", "Ph√°t hi·ªán gian l·∫≠n: Th·ªùi gian ra kh∆°i kh√¥ng ƒë·ªß ƒë·ªÉ t√≠ch l≈©y s·ªë xu n√†y.");
            if (!reason) return;

            db.ref(\`users/\${uid}\`).once('value', (snap) => {
                const data = snap.val();
                const newCoins = (Number(data.coins) || 0) + Number(amount);
                
                const updates = {};
                updates[\`users/\${uid}/coins\`] = newCoins;
                updates[\`users/\${uid}/history/\${idx}/status\`] = "‚ùå T·ª´ ch·ªëi: " + reason;

                db.ref().update(updates).then(() => alert("ƒê√£ h·ªßy l·ªánh v√† ho√†n ti·ªÅn cho ng∆∞·ªùi d√πng!"));
            });
        }
    </script>
</body>
</html>
