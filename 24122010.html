<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quáº£n trá»‹ Lá»‡nh RÃºt - Fish Mining</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; }
        .admin-card { background: #1e293b; border: 1px solid #334155; border-radius: 1rem; transition: 0.3s; }
        .admin-card:hover { border-color: #3b82f6; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-bold text-blue-400">Há»† THá»NG QUáº¢N TRá»Š ğŸš€</h1>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-full font-bold">LÃ m má»›i ğŸ”„</button>
        </div>

        <div id="loading" class="text-center py-20 text-gray-500">Äang quÃ©t lá»‡nh rÃºt tá»« há»‡ thá»‘ng...</div>
        
        <div id="section-withdraw" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            </div>
    </div>

    <script>
        // Cáº¤U HÃŒNH FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyAc0psT5Up6aEu0VnCz1TZ4sSNTKmif8oA",
            authDomain: "telegram-bot-backup-11c83.firebaseapp.com",
            databaseURL: "https://telegram-bot-backup-11c83-default-rtdb.firebaseio.com",
            projectId: "telegram-bot-backup-11c83",
            storageBucket: "telegram-bot-backup-11c83.firebasestorage.app",
            messagingSenderId: "363675104532",
            appId: "1:363675104532:web:6c51d1c7318b765e897e01"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // HÃ€M QUÃ‰T TOÃ€N Bá»˜ USER Äá»‚ TÃŒM Lá»†NH RÃšT
        db.ref('users').on('value', (snapshot) => {
            document.getElementById('loading').style.display = 'none';
            const users = snapshot.val();
            const container = document.getElementById('section-withdraw');
            let html = '';
            let count = 0;

            if (!users) {
                container.innerHTML = '<p class="col-span-full text-center py-10">Há»‡ thá»‘ng chÆ°a cÃ³ ngÆ°á»i dÃ¹ng nÃ o.</p>';
                return;
            }

            for (let uid in users) {
                const user = users[uid];
                // Chá»‰ duyá»‡t qua nhá»¯ng user cÃ³ lá»‹ch sá»­
                if (user.history && Array.isArray(user.history)) {
                    user.history.forEach((item, index) => {
                        // Chá»‰ hiá»‡n lá»‡nh "Äang xá»­ lÃ½"
                        if (item.status === 'ğŸ• Äang xá»­ lÃ½') {
                            count++;
                            html += `
                            <div class="admin-card p-6 shadow-xl">
                                <div class="flex justify-between mb-4">
                                    <span class="text-xs text-blue-500 font-mono">ID: ${uid}</span>
                                    <span class="text-xs text-gray-500">${item.time}</span>
                                </div>
                                <div class="text-2xl font-bold text-yellow-500 mb-4">${Number(item.amount).toLocaleString()} VNÄ</div>
                                <div class="space-y-2 text-sm">
                                    <p>ğŸ‘¤ <span class="text-gray-400">Chá»§ TK:</span> <b>${item.bankOwner || 'N/A'}</b></p>
                                    <p>ğŸ¦ <span class="text-gray-400">NgÃ¢n hÃ ng:</span> <b>${item.bankName || 'N/A'}</b></p>
                                    <p>ğŸ’³ <span class="text-gray-400">Sá»‘ TK:</span> <b>${item.bankAcc || 'N/A'}</b></p>
                                </div>
                                <div class="flex gap-3 mt-6">
                                    <button onclick="updateStatus('${uid}', ${index}, 'âœ… ThÃ nh cÃ´ng')" class="flex-1 bg-green-600 py-2 rounded-lg font-bold text-xs">DUYá»†T</button>
                                    <button onclick="refundPrompt('${uid}', ${index}, ${item.amount})" class="flex-1 bg-red-600 py-2 rounded-lg font-bold text-xs">Há»¦Y (CHEAT)</button>
                                </div>
                            </div>`;
                        }
                    });
                }
            }

            container.innerHTML = count > 0 ? html : '<div class="col-span-full text-center py-10 text-gray-500">ğŸ‰ Tuyá»‡t vá»i! KhÃ´ng cÃ²n lá»‡nh rÃºt nÃ o Ä‘ang chá» xá»­ lÃ½.</div>';
        });

        // HÃ€M DUYá»†T Lá»†NH
        function updateStatus(uid, idx, status) {
            if(confirm(`XÃ¡c nháº­n lá»‡nh rÃºt cá»§a ngÆ°á»i dÃ¹ng ${uid} Ä‘Ã£ hoÃ n táº¥t?`)) {
                db.ref(\`users/\${uid}/history/\${idx}\`).update({ status: status });
            }
        }

        // HÃ€M Há»¦Y & HOÃ€N TIá»€N (CHá»NG HACK Má»œI Báº N BÃˆ)
        function refundPrompt(uid, idx, amount) {
            const reason = "Há»§y do check má»i báº¡n bÃ¨ áº£o / cheat há»‡ thá»‘ng.";
            if(confirm(`Há»§y lá»‡nh nÃ y? Tiá»n sáº½ Ä‘Æ°á»£c tráº£ láº¡i cho user.\nLÃ½ do: \${reason}`)) {
                db.ref(\`users/\${uid}\`).once('value', (snap) => {
                    const data = snap.val();
                    const newBalance = (Number(data.coins) || 0) + Number(amount);
                    
                    const updates = {};
                    updates[\`users/\${uid}/coins\`] = newBalance;
                    updates[\`users/\${uid}/history/\${idx}/status\`] = "âŒ Há»§y: " + reason;
                    
                    db.ref().update(updates).then(() => alert("ÄÃ£ há»§y vÃ  hoÃ n tiá»n!"));
                });
            }
        }
    </script>
</body>
</html>
