<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Qu·∫£n tr·ªã - Fish Mining</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-yellow-500">H·ªÜ TH·ªêNG QU·∫¢N TR·ªä</h1>
                <p class="text-gray-400 text-sm">Qu·∫£n l√Ω r√∫t ti·ªÅn & Ch·ªëng hack [cite: 2026-01-24]</p>
            </div>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-bold transition">L√†m m·ªõi üîÑ</button>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="glass-card p-6 rounded-2xl">
                <p class="text-gray-400">Ch·ªù duy·ªát</p>
                <h2 id="pending-count" class="text-2xl font-bold text-orange-400">0</h2>
            </div>
            <div class="glass-card p-6 rounded-2xl">
                <p class="text-gray-400">T·ªïng User</p>
                <h2 id="total-users" class="text-2xl font-bold text-blue-400">0</h2>
            </div>
        </div>

        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">üì• L·ªánh r√∫t ti·ªÅn ch·ªù x·ª≠ l√Ω</h3>
        <div id="section-withdraw" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="col-span-full text-center py-10 text-gray-500 italic">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh Firebase (D√πng ƒë√∫ng config c·ªßa b·∫°n)
        const firebaseConfig = {
            apiKey: "AIzaSyAc0psT5Up6aEu0VnCz1TZ4sSNTKmif8oA",
            authDomain: "telegram-bot-backup-11c83.firebaseapp.com",
            databaseURL: "https://telegram-bot-backup-11c83-default-rtdb.firebaseio.com",
            projectId: "telegram-bot-backup-11c83",
            storageBucket: "telegram-bot-backup-11c83.firebasestorage.app",
            messagingSenderId: "363675104532",
            appId: "1:363675104532:web:6c51d1c7318b765e897e01"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. Hi·ªÉn th·ªã l·ªánh r√∫t ti·ªÅn [cite: 2026-01-24]
        db.ref('users').on('value', (snapshot) => {
            const users = snapshot.val() || {};
            const container = document.getElementById('section-withdraw');
            let html = '';
            let count = 0;
            let userCount = Object.keys(users).length;

            for (let uid in users) {
                const user = users[uid];
                if (user.history) {
                    user.history.forEach((item, idx) => {
                        if (item.status === 'üïê ƒêang x·ª≠ l√Ω') {
                            count++;
                            html += `
                            <div class="glass-card p-5 rounded-2xl border-l-4 border-orange-500 animate-fade-in">
                                <div class="flex justify-between items-start mb-3">
                                    <span class="text-[10px] text-blue-400 font-mono">ID: ${uid}</span>
                                    <span class="bg-orange-500/20 text-orange-400 text-[10px] px-2 py-1 rounded">PENDING</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">${Number(item.amount).toLocaleString()} Xu</h3>
                                <div class="space-y-1 text-sm text-gray-300">
                                    <p>üè¶ <b>Ng√¢n h√†ng:</b> ${item.bankName || 'N/A'}</p>
                                    <p>üí≥ <b>STK:</b> ${item.bankAcc || 'N/A'}</p>
                                    <p>üë§ <b>T√™n:</b> <span class="text-yellow-400">${item.bankOwner || 'N/A'}</span></p>
                                    <p class="text-[10px] text-gray-500 mt-2">‚è∞ ${item.time}</p>
                                </div>
                                <div class="grid grid-cols-2 gap-2 mt-4">
                                    <button onclick="updateStatus('${uid}', ${idx}, '‚úÖ Th√†nh c√¥ng')" 
                                        class="bg-green-600 hover:bg-green-700 py-2 rounded-lg font-bold text-xs transition">DUY·ªÜT ‚úÖ</button>
                                    <button onclick="refundPrompt('${uid}', ${idx}, ${item.amount})" 
                                        class="bg-red-600 hover:bg-red-700 py-2 rounded-lg font-bold text-xs transition">H·ª¶Y & HO√ÄN TI·ªÄN ‚ùå</button>
                                </div>
                            </div>`;
                        }
                    });
                }
            }

            document.getElementById('pending-count').innerText = count;
            document.getElementById('total-users').innerText = userCount;
            container.innerHTML = count > 0 ? html : '<div class="col-span-full text-center py-10 text-gray-500">Kh√¥ng c√≥ l·ªánh ch·ªù duy·ªát n√†o!</div>';
        });

        // 2. Duy·ªát l·ªánh r√∫t ti·ªÅn
        function updateStatus(uid, idx, status) {
            if (!confirm(`X√°c nh·∫≠n ƒë·ªïi tr·∫°ng th√°i th√†nh ${status}?`)) return;
            db.ref(`users/${uid}/history/${idx}`).update({ status: status })
            .then(() => alert('ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng!'));
        }

        // 3. H·ªßy l·ªánh, ho√†n ti·ªÅn v√† ch·ªëng hack m·ªùi b·∫°n b√® [cite: 2026-01-24]
        function refundPrompt(uid, idx, amount) {
            const reason = "H·ªßy do check m·ªùi b·∫°n b√® kh√¥ng h·ª£p l·ªá (·∫¢o/Cheat)";
            if (!confirm(`H·ªßy l·ªánh n√†y v√† ho√†n tr·∫£ ${amount} xu cho ng∆∞·ªùi d√πng?\nL√Ω do: ${reason}`)) return;

            // ƒê·ªçc d·ªØ li·ªáu user hi·ªán t·∫°i ƒë·ªÉ ho√†n ti·ªÅn
            db.ref(`users/${uid}`).once('value', (snap) => {
                const userData = snap.val();
                const newCoins = (Number(userData.coins) || 0) + Number(amount);

                // Th·ª±c hi·ªán 2 vi·ªác c√πng l√∫c: C·∫≠p nh·∫≠t status l·ªãch s·ª≠ v√† c·ªông l·∫°i ti·ªÅn cho user
                const updates = {};
                updates[`users/${uid}/coins`] = newCoins;
                updates[`users/${uid}/history/${idx}/status`] = `‚ùå B·ªã t·ª´ ch·ªëi: ${reason}`;

                db.ref().update(updates).then(() => {
                    alert('ƒê√£ h·ªßy l·ªánh, ho√†n ti·ªÅn v√† g·ª≠i th√¥ng b√°o l√Ω do!');
                }).catch(err => alert('L·ªói: ' + err.message));
            });
        }
    </script>
</body>
</html>
