<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://sad.adsgram.ai/js/adsgram-ad-sdk.js"></script>

<script>
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let endTime = localStorage.getItem('fishingEndTime') || 0;
    let fishInterval;

    // Kh·ªüi t·∫°o Adsgram (Thay 'YOUR_BLOCK_ID' b·∫±ng ID th·∫≠t c·ªßa b·∫°n)
    const AdController = window.Adsgram.init({ blockId: "YOUR_BLOCK_ID" });

    function startFishingProcess() {
        // 1. G·ªçi qu·∫£ng c√°o
        AdController.show().then((result) => {
            // Ng∆∞·ªùi d√πng ƒë√£ xem h·∫øt qu·∫£ng c√°o
            setupFishingTime(3 * 60 * 60); // 3 ti·∫øng = 10800 gi√¢y
        }).catch((result) => {
            // L·ªói ho·∫∑c ng∆∞·ªùi d√πng b·ªè ngang qu·∫£ng c√°o
            alert("B·∫°n c·∫ßn xem h·∫øt qu·∫£ng c√°o ƒë·ªÉ c√≥ th·ªÉ ra kh∆°i!");
        });
    }

    function setupFishingTime(seconds) {
        const now = Date.now();
        endTime = now + (seconds * 1000);
        localStorage.setItem('fishingEndTime', endTime);
        runFishingUI();
    }

    function runFishingUI() {
        const btn = document.getElementById('btn-action');
        const boat = document.getElementById('boat');
        const speedDisplay = document.getElementById('speed-display');

        if (fishInterval) clearInterval(fishInterval);

        fishInterval = setInterval(() => {
            const now = Date.now();
            const remaining = endTime - now;

            if (remaining <= 0) {
                stopFishing();
            } else {
                // ƒêang trong th·ªùi gian ƒë√°nh c√°
                createFishEffect();
                coins += 1;
                document.getElementById('coin-display').innerText = coins;
                localStorage.setItem('coins', coins);

                // C·∫≠p nh·∫≠t giao di·ªán
                btn.disabled = true;
                boat.classList.add('boat-float');
                speedDisplay.innerText = "5";
                
                // Hi·ªÉn th·ªã ƒë·∫øm ng∆∞·ª£c th·ªùi gian c√≤n l·∫°i
                const h = Math.floor(remaining / 3600000);
                const m = Math.floor((remaining % 3600000) / 60000);
                const s = Math.floor((remaining % 60000) / 1000);
                btn.innerText = `‚è≥ C√≤n ${h}h ${m}m ${s}s`;
            }
        }, 1000); // M·ªói gi√¢y c·ªông ti·ªÅn v√† ki·ªÉm tra th·ªùi gian
    }

    function stopFishing() {
        clearInterval(fishInterval);
        const btn = document.getElementById('btn-action');
        btn.disabled = false;
        btn.innerText = "üö¢ Ra kh∆°i";
        document.getElementById('boat').classList.remove('boat-float');
        document.getElementById('speed-display').innerText = "0";
        localStorage.removeItem('fishingEndTime');
    }

    // T·ª± ƒë·ªông ch·∫°y l·∫°i n·∫øu c√≤n th·ªùi gian khi ng∆∞·ªùi d√πng t·∫£i l·∫°i trang
    window.onload = () => {
        document.getElementById('coin-display').innerText = coins;
        if (endTime && endTime > Date.now()) {
            runFishingUI();
        }
    };

    // H√†m t·∫°o hi·ªáu ·ª©ng c√° (gi·ªØ nguy√™n nh∆∞ c≈©)
    function createFishEffect() {
        const container = document.getElementById('effect-layer');
        const fish = document.createElement('div');
        const randomX = (Math.random() - 0.5) * 100;
        fish.className = 'fish-particle text-2xl';
        fish.innerHTML = 'üêü <span class="text-xs text-yellow-300 font-bold">+1</span>';
        fish.style.left = '50%';
        fish.style.top = '50%';
        fish.style.setProperty('--tw-x', `${randomX}px`);
        container.appendChild(fish);
        setTimeout(() => fish.remove(), 1000);
    }
</script>
