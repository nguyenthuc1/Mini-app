<!DOCTYPE html>
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>SUPER-MONEYMINE</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#fff;
  padding:15px;
}
.card{
  background:#1e293b;
  padding:12px;
  margin-bottom:12px;
  border-radius:10px;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  background:#22c55e;
}
button:disabled{
  background:#64748b;
}
.warn{
  color:#f87171;
  font-size:13px;
}
</style>
</head>

<body>
<h2>ğŸ’° NHIá»†M Vá»¤ KIáº¾M TIá»€N</h2>

<p id="user"></p>
<p>ğŸ’ Äiá»ƒm: <b><span id="point">0</span></b></p>
<p class="warn" id="warn"></p>

<div class="card">
ğŸ“¢ Tham gia Telegram  
<br><br>
<button onclick="doTask(1,'https://t.me/telegram')">LÃ m nhiá»‡m vá»¥</button>
</div>

<div class="card">
ğŸŒ Truy cáº­p website  
<br><br>
<button onclick="doTask(2,'https://google.com')">LÃ m nhiá»‡m vá»¥</button>
</div>

<div class="card">
ğŸ“… Äiá»ƒm danh hÃ´m nay  
<br><br>
<button onclick="daily()">Äiá»ƒm danh</button>
</div>

<script>
/* ===== TELEGRAM INIT ===== */
const tg = window.Telegram.WebApp;
tg.expand();

if(!tg.initDataUnsafe || !tg.initDataUnsafe.user){
  document.body.innerHTML = "âŒ Vui lÃ²ng má»Ÿ app trong Telegram";
  throw new Error("Not Telegram");
}

const userId = tg.initDataUnsafe.user.id;
document.getElementById("user").innerText = "ğŸ‘¤ User ID: " + userId;

/* ===== STORAGE KEY ===== */
const POINT_KEY = "point_"+userId;
const MAX_POINT = 1000;
const COOLDOWN = 5000;

/* ===== LOAD POINT ===== */
let point = Number(localStorage.getItem(POINT_KEY)) || 0;
updatePoint();

/* ===== ANTI SPAM ===== */
function checkCooldown(){
  let now = Date.now();
  let last = Number(localStorage.getItem("last_"+userId)) || 0;
  if(now - last < COOLDOWN){
    showWarn("âš ï¸ Thao tÃ¡c quÃ¡ nhanh!");
    return false;
  }
  localStorage.setItem("last_"+userId, now);
  return true;
}

/* ===== TASK ===== */
<script>
const tg = window.Telegram.WebApp;
const userId = tg.initDataUnsafe.user.id;

function doTask(taskId, link){
  const taskKey = "task_done_"+taskId+"_"+userId;
  const pendingKey = "task_pending_"+taskId+"_"+userId;

  if(localStorage.getItem(taskKey)){
    alert("âŒ Nhiá»‡m vá»¥ Ä‘Ã£ hoÃ n thÃ nh");
    return;
  }

  // ÄÃ¡nh dáº¥u Ä‘ang lÃ m nhiá»‡m vá»¥
  localStorage.setItem(pendingKey, Date.now());

  // Má»Ÿ link nhiá»‡m vá»¥
  tg.openLink(link);

  alert("ğŸ”” Sau khi hoÃ n thÃ nh, quay láº¡i app vÃ  báº¥m XÃC NHáº¬N");
}

// Gá»i khi user báº¥m xÃ¡c nháº­n
function confirmTask(taskId){
  const taskKey = "task_done_"+taskId+"_"+userId;
  const pendingKey = "task_pending_"+taskId+"_"+userId;

  if(localStorage.getItem(taskKey)){
    alert("âŒ Nhiá»‡m vá»¥ Ä‘Ã£ hoÃ n thÃ nh");
    return;
  }

  const startTime = localStorage.getItem(pendingKey);
  if(!startTime){
    alert("âš ï¸ Báº¡n chÆ°a lÃ m nhiá»‡m vá»¥");
    return;
  }

  const spent = Date.now() - startTime;
  if(spent < 5000){ // 5 giÃ¢y
    alert("âš ï¸ LÃ m nhiá»‡m vá»¥ quÃ¡ nhanh");
    return;
  }

  // HoÃ n thÃ nh
  localStorage.removeItem(pendingKey);
  localStorage.setItem(taskKey, "done");

  addPoint(10);
  alert("âœ… HoÃ n thÃ nh nhiá»‡m vá»¥ +10 Ä‘iá»ƒm");
}



/* ===== DAILY CHECK-IN ===== */
function daily(){
  if(!checkCooldown()) return;

  let today = new Date().toDateString();
  let key = "daily_"+userId;

  if(localStorage.getItem(key) === today){
    alert("âŒ HÃ´m nay Ä‘Ã£ Ä‘iá»ƒm danh");
    return;
  }

  localStorage.setItem(key, today);
  addPoint(5);
}

/* ===== ADD POINT ===== */
function addPoint(x){
  point += x;

  if(point > MAX_POINT){
    point = MAX_POINT;
  }

  localStorage.setItem(POINT_KEY, point);
  updatePoint();
}

/* ===== UI ===== */
function updatePoint(){
  document.getElementById("point").innerText = point;
}

function showWarn(msg){
  let w = document.getElementById("warn");
  w.innerText = msg;
  setTimeout(()=>w.innerText="",2000);
}
</script>
</body>
</html>
