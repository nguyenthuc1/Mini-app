<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Nhi·ªám v·ª• truy c·∫≠p link</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;padding:15px}
.card{background:#1e293b;padding:12px;border-radius:10px;margin-bottom:12px}
button{padding:8px 12px;border:none;border-radius:6px;font-weight:bold}
.do{background:#22c55e}
.ok{background:#38bdf8;margin-left:6px}
.small{font-size:13px;color:#cbd5e1}
</style>
</head>
<body>

<h2>üí∞ NHI·ªÜM V·ª§ KI·∫æM TI·ªÄM</h2>
<p id="user"></p>
<p>$: <b><span id="point">0</span></b></p>

<div class="card">
üåê Truy c·∫≠p website<br>
<span class="small">·ªû l·∫°i t·ªëi thi·ªÉu 15 gi√¢y</span><br><br>
<button class="do" onclick="doTask(1,'https://example.com')">L√†m nhi·ªám v·ª•</button>
<button class="ok" onclick="confirmTask(1)">X√°c nh·∫≠n</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

// B·∫ÆT BU·ªòC M·ªû TRONG TELEGRAM
if(!tg.initDataUnsafe?.user){
  document.body.innerHTML="‚ùå Vui l√≤ng m·ªü trong Telegram";
  throw new Error("Not Telegram");
}

const userId = tg.initDataUnsafe.user.id;
document.getElementById("user").innerText = "üë§ User ID: "+userId;

// ƒêI·ªÇM
const POINT_KEY = "point_"+userId;
let point = Number(localStorage.getItem(POINT_KEY)) || 0;
document.getElementById("point").innerText = point;

// L√ÄM NHI·ªÜM V·ª§
function doTask(id, link){
  if(localStorage.getItem("done_"+id+"_"+userId)){
    alert("‚ùå Nhi·ªám v·ª• ƒë√£ ho√†n th√†nh");
    return;
  }
  localStorage.setItem("pending_"+id+"_"+userId, Date.now());
  tg.openLink(link); // m·ªü link h·ª£p l·ªá
  alert("üîî Quay l·∫°i app v√† b·∫•m X√ÅC NH·∫¨N");
}

// X√ÅC NH·∫¨N
function confirmTask(id){
  const start = localStorage.getItem("pending_"+id+"_"+userId);
  if(!start){ alert("‚ö†Ô∏è Ch∆∞a l√†m nhi·ªám v·ª•"); return; }
  if(Date.now() - start < 15000){ alert("‚ö†Ô∏è L√†m qu√° nhanh"); return; }

  localStorage.removeItem("pending_"+id+"_"+userId);
  localStorage.setItem("done_"+id+"_"+userId,"yes");
  addPoint(10);
  alert("‚úÖ Ho√†n th√†nh +100ƒë");
}

// C·ªòNG ƒêI·ªÇM
function addPoint(x){
  point += x;
  localStorage.setItem(POINT_KEY, point);
  document.getElementById("point").innerText = point;
}
</script>
</body>
</html>
