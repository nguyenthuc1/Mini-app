<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Nhiá»‡m vá»¥ truy cáº­p link</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;padding:15px}
.card{background:#1e293b;padding:12px;border-radius:10px;margin-bottom:12px}
button{padding:8px 12px;border:none;border-radius:6px;font-weight:bold}
.do{background:#22c55e}
.ok{background:#38bdf8;margin-left:6px}
.small{font-size:13px;color:#cbd5e1}
</style>
</head>
<body>

<h2>ğŸ’° NHIá»†M Vá»¤ KIáº¾M TIá»€M</h2>
<p id="user"></p>
<p>$: <b><span id="point">0</span></b></p>

<div class="card">
ğŸŒ Truy cáº­p website #1 Ä‘Æ°á»£c 200Ä‘<br>
<span class="small">á» láº¡i tá»‘i thiá»ƒu 15 giÃ¢y</span><br><br>
<button class="do" onclick="doTask(1,'https://example.com')">LÃ m nhiá»‡m vá»¥</button>
<button class="ok" onclick="confirmTask(1)">XÃ¡c nháº­n</button>
</div>
<div class="card">
ğŸŒ Truy cáº­p website #2 Ä‘Æ°á»£c 200Ä‘<br>
<span class="small">á» láº¡i tá»‘i thiá»ƒu 15 giÃ¢y</span><br><br>
<button class="do" onclick="doTask(2,'https://another.com')">LÃ m nhiá»‡m vá»¥</button>
<button class="ok" onclick="confirmTask(2)">XÃ¡c nháº­n</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

// Báº®T BUá»˜C Má» TRONG TELEGRAM
if(!tg.initDataUnsafe?.user){
  document.body.innerHTML="âŒ Vui lÃ²ng má»Ÿ trong Telegram";
  throw new Error("Not Telegram");
}

const userId = tg.initDataUnsafe.user.id;
document.getElementById("user").innerText = "ğŸ‘¤ User ID: "+userId;

// ÄIá»‚M
const POINT_KEY = "point_"+userId;
let point = Number(localStorage.getItem(POINT_KEY)) || 0;
document.getElementById("point").innerText = point;

// LÃ€M NHIá»†M Vá»¤
function doTask(id, link){
  if(localStorage.getItem("done_"+id+"_"+userId)){
    alert("âŒ Nhiá»‡m vá»¥ Ä‘Ã£ hoÃ n thÃ nh");
    return;
  }
  localStorage.setItem("pending_"+id+"_"+userId, Date.now());
  tg.openLink(link); // má»Ÿ link há»£p lá»‡
  alert("ğŸ”” Quay láº¡i app vÃ  báº¥m XÃC NHáº¬N");
}

// XÃC NHáº¬N
function confirmTask(id){
  const start = localStorage.getItem("pending_"+id+"_"+userId);
  if(!start){ alert("âš ï¸ ChÆ°a lÃ m nhiá»‡m vá»¥"); return; }
  if(Date.now() - start < 15000){ alert("âš ï¸ LÃ m quÃ¡ nhanh"); return; }

  localStorage.removeItem("pending_"+id+"_"+userId);
  localStorage.setItem("done_"+id+"_"+userId,"yes");
  addPoint(10);
  alert("âœ… HoÃ n thÃ nh +100Ä‘");
}

// Cá»˜NG ÄIá»‚M
function addPoint(x){
  point += x;
  localStorage.setItem(POINT_KEY, point);
  document.getElementById("point").innerText = point;
}
</script>
</body>
</html>
