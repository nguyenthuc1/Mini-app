<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini App Ki·∫øm Ti·ªÅn</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  font-family: Arial;
  background: #0f172a;
  color: white;
  text-align: center;
  padding: 20px;
}
.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 12px;
}
button {
  margin-top: 15px;
  padding: 12px 20px;
  font-size: 18px;
  border-radius: 8px;
  border: none;
  background: #22c55e;
  color: black;
}
</style>
</head>

<body>

<div class="card">
  <h2>üí∞ XEM QU·∫¢NG C√ÅO KI·∫æM TI·ªÄN</h2>
  <p>ID Telegram: <b id="uid"></b></p>
  <p>S·ªë d∆∞: <b id="coin">0</b> ƒëi·ªÉm</p>

  <button onclick="watchAd()">‚ñ∂Ô∏è Xem qu·∫£ng c√°o</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

const userId = tg.initDataUnsafe.user.id;
const COOLDOWN = 60;      // 60 gi√¢y gi·ªØa m·ªói l·∫ßn xem
const WATCH_TIME = 10;   // ph·∫£i xem √≠t nh·∫•t 10 gi√¢y

let coin = parseInt(localStorage.getItem("coin_" + userId)) || 0;
let lastWatch = parseInt(localStorage.getItem("lastWatch_" + userId)) || 0;
let watching = false;
let timer = null;
let startTime = 0;

document.getElementById("uid").innerText = userId;
document.getElementById("coin").innerText = coin;

function watchAd() {
  const now = Date.now();

  if (watching) {
    tg.showAlert("‚ùå B·∫°n ƒëang xem qu·∫£ng c√°o r·ªìi");
    return;
  }

  if (now - lastWatch < COOLDOWN * 1000) {
    let wait = Math.ceil((COOLDOWN * 1000 - (now - lastWatch)) / 1000);
    tg.showAlert("‚è≥ Vui l√≤ng ch·ªù " + wait + " gi√¢y");
    return;
  }

  watching = true;
  startTime = Date.now();

  window.open("https://example-ads-link.com", "_blank");
  tg.showAlert("üëÄ Vui l√≤ng xem qu·∫£ng c√°o ƒë·ªß " + WATCH_TIME + " gi√¢y");

  timer = setInterval(checkWatch, 1000);
}

function checkWatch() {
  if (document.hidden) return; // v·∫´n ƒëang xem qu·∫£ng c√°o

  let watched = Math.floor((Date.now() - startTime) / 1000);

  if (watched >= WATCH_TIME) {
    finishWatch();
  }
}

function finishWatch() {
  clearInterval(timer);
  watching = false;

  lastWatch = Date.now();
  localStorage.setItem("lastWatch_" + userId, lastWatch);

  coin += 10;
  localStorage.setItem("coin_" + userId, coin);
  document.getElementById("coin").innerText = coin;

  tg.showAlert("üéâ Th√†nh c√¥ng! +10 ƒëi·ªÉm");
}

document.addEventListener("visibilitychange", () => {
  // d√πng ƒë·ªÉ ki·ªÉm tra tab
});
</script>

</body>
</html>
